# Fail2Ban カスタムフィルター設定

[postfix-relay-denied]
# リレー拒否攻撃の検出
failregex = postfix/smtpd\[\d+\]: NOQUEUE: reject: RCPT from .*\[<HOST>\].*: 554 5\.7\.1 Relay access denied

[postfix-unknown-user]
# 存在しないユーザーへの攻撃
failregex = postfix/smtpd\[\d+\]: NOQUEUE: reject: RCPT from .*\[<HOST>\].*: 550 5\.1\.1 .*: Recipient address rejected: User unknown in local recipient table

[postfix-rate-limit]
# レート制限違反
failregex = postfix/anvil\[\d+\]: statistics: max connection rate \d+/\d+s for \(smtp:<HOST>\) at

[postfix-auth-failure]
# Postfix認証失敗
failregex = postfix/smtpd\[\d+\]: warning: .*\[<HOST>\]: SASL authentication failure.*
            postfix/smtpd\[\d+\]: lost connection after AUTH from .*\[<HOST>\]

[dovecot-auth-failure] 
# Dovecot認証失敗
failregex = dovecot: auth-worker\(\d+\): .*\(.*,<HOST>,.*\): pam_authenticate\(\) failed.*
            dovecot: imap-login: Disconnected \(auth failed.*rip=<HOST>.*
            dovecot: pop3-login: Disconnected \(auth failed.*rip=<HOST>.*
