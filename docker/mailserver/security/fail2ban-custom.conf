# Fail2Ban カスタムセキュリティ設定
# 強化されたメールサーバーセキュリティ

[DEFAULT]
# デフォルトのBANアクション設定
banaction = iptables-multiport
banaction_allports = iptables-allports
bantime = 7200
findtime = 600
maxretry = 3
backend = systemd

# メール通知設定（簡素化）
destemail = admin@denzirou.com
sendername = Fail2Ban-Mailserver
action = %(action_)s

[sshd]
enabled = true
port = ssh
filter = sshd
logpath = /var/log/auth.log
maxretry = 3
bantime = 7200

[postfix]
enabled = true
port = smtp,465,587
filter = postfix
logpath = /var/log/mail.log
maxretry = 3
bantime = 3600

[postfix-sasl]
enabled = true
port = smtp,465,587
filter = postfix-sasl
logpath = /var/log/mail.log
maxretry = 3
bantime = 3600

[postfix-rbl]
enabled = true
port = smtp,465,587
filter = postfix-rbl
logpath = /var/log/mail.log
maxretry = 1
bantime = 3600

[dovecot]
enabled = true
port = pop3,pop3s,imap,imaps,993,995
filter = dovecot
logpath = /var/log/mail.log
maxretry = 3
bantime = 3600

# 新しいカスタムフィルター
[postfix-relay-denied]
enabled = true
port = smtp,465,587
filter = postfix-relay-denied
logpath = /var/log/mail.log
maxretry = 2
bantime = 7200

[postfix-unknown-user]
enabled = true
port = smtp,465,587
filter = postfix-unknown-user
logpath = /var/log/mail.log
maxretry = 3
bantime = 3600

[postfix-rate-limit]
enabled = true
port = smtp,465,587
filter = postfix-rate-limit
logpath = /var/log/mail.log
maxretry = 5
bantime = 1800

# メール関連セキュリティ強化
[postfix-auth-failure]
enabled = true
port = smtp,465,587
filter = postfix-auth-failure
logpath = /var/log/mail/mail.log
maxretry = 3
bantime = 7200

[dovecot-auth-failure]
enabled = true
port = imap,imaps,pop3,pop3s
filter = dovecot-auth-failure
logpath = /var/log/mail/mail.log
maxretry = 3
bantime = 7200

# 高度なセキュリティ設定
[recidive]
enabled = true
filter = recidive
logpath = /var/log/fail2ban.log
action = %(action_)s
bantime = 604800
findtime = 86400
maxretry = 3