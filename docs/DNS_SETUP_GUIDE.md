# DNS設定ガイド - denzirou.jp ドメイン

## 🎯 設定目標

**現在の状況:**

- `denzirou.jp` → `150.95.255.38` (旧サーバー)
- Sakura VPS: `133.167.99.187`

**設定後の構成:**

- `denzirou.jp` → `133.167.99.187` (本番環境)
- `dev.denzirou.jp` → `133.167.99.187` (開発環境)

## 📋 必要なDNS設定

### 1. Aレコードの設定

| ホスト名 | タイプ | 値 | 用途 |
|---------|--------|-----|------|
| @ (apex) | A | 133.167.99.187 | 本番環境 (denzirou.jp) |
| www | A | 133.167.99.187 | 本番環境 (<www.denzirou.jp>) |
| dev | A | 133.167.99.187 | 開発環境 (dev.denzirou.jp) |

### 2. メール用DNS設定（将来対応）

| ホスト名 | タイプ | 値 | 用途 |
|---------|--------|-----|------|
| mail | A | 133.167.99.187 | メールサーバー |
| @ | MX | 10 mail.denzirou.com | MXレコード |

## 🔧 設定手順

### Step 1: DNSプロバイダーにアクセス

1. denzirou.jpドメインの管理画面にログイン
2. DNS設定またはゾーン設定のページを開く

### Step 2: Aレコードの変更

```text
# 現在の設定を削除/変更
denzirou.jp.     A    150.95.255.38  → 133.167.99.187

# 新規追加
www.denzirou.jp. A    133.167.99.187
dev.denzirou.jp. A    133.167.99.187
```

### Step 3: 設定の反映確認

```bash
# DNS変更後の確認コマンド
dig +short A denzirou.jp
dig +short A www.denzirou.jp  
dig +short A dev.denzirou.jp

# 期待する結果: すべて 133.167.99.187
```

### Step 4: TTL（Time To Live）の考慮

- 変更前にTTLを短く設定（300秒など）
- 変更後は適切な値に戻す（3600秒など）

## ⚠️ 注意事項

### DNS変更のリスク

1. **ダウンタイム**: 旧サーバーから新サーバーへの切り替え時
2. **キャッシュ**: ISPやブラウザのDNSキャッシュによる遅延
3. **メール**: メール設定がある場合は慎重に

### 推奨手順

1. **段階的移行**: まず `dev.denzirou.jp` を先に設定
2. **テスト確認**: 開発環境で動作確認
3. **本番移行**: `denzirou.jp` の設定変更

## 🚀 移行後の確認項目

### 本番環境 (denzirou.jp)

- [ ] Webサイトが正常に表示される
- [ ] HTTPからHTTPSへのリダイレクト
- [ ] SSL証明書の自動取得

### 開発環境 (dev.denzirou.jp)  

- [ ] Basic認証が正常に動作
- [ ] 開発用サイトが表示される
- [ ] 本番環境と独立している

## 📞 問題が発生した場合

### 緊急時のロールバック

1. DNS設定を元に戻す
2. TTLが短い場合は比較的早く反映

### よくある問題

- **DNS変更が反映されない** → TTL時間を待つ、またはDNSキャッシュをクリア
- **SSL証明書エラー** → Let's Encryptの再設定
- **サイトが表示されない** → Nginx設定の確認

---

**このガイドに従って DNS設定を実行してください。**
**設定完了後、次のステップ（メインプロキシ設定）を実行します。**
